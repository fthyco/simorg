(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{98105:function(e,t,a){Promise.resolve().then(a.bind(a,15558))},15558:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var s=a(57437),l=a(2265),n=a(71837),i=a(52542);a(36190);let r={worldNode:function(e){let{data:t}=e;return(0,s.jsxs)("div",{className:"world-node",children:[(0,s.jsxs)("div",{className:"world-node-content",children:[(0,s.jsx)("h3",{children:t.label}),(0,s.jsxs)("div",{className:"world-metrics",children:[(0,s.jsxs)("div",{className:"w-metric",children:[(0,s.jsx)("span",{children:"roles"}),(0,s.jsx)("strong",{children:t.roleCount})]}),(0,s.jsxs)("div",{className:"w-metric",children:[(0,s.jsx)("span",{children:"active"}),(0,s.jsx)("strong",{children:t.activeCount})]}),(0,s.jsxs)("div",{className:"w-metric",children:[(0,s.jsx)("span",{children:"debt"}),(0,s.jsx)("strong",{style:{color:t.debt>5?"#ef4444":t.debt>0?"#f59e0b":"inherit"},children:t.debt})]}),(0,s.jsxs)("div",{className:"w-metric",children:[(0,s.jsx)("span",{children:"density"}),(0,s.jsxs)("strong",{children:[t.densityPct,"%"]})]})]}),(0,s.jsxs)("div",{style:{fontSize:"11px",color:"#9ca3af",marginTop:"8px",letterSpacing:"0.02em"},children:[t.eventCount," events / ",t.deptCount," departments"]})]}),(0,s.jsx)("div",{className:"world-actions",children:(0,s.jsx)("button",{className:"btn btn-sm btn-primary",onClick:t.onZoomIn,children:"Departments"})})]})}};function o(e){var t,a,n,o,d,c,m,u,p,h;let{state:v,onZoomIn:x}=e,g=v?Object.keys(v.roles).length:0,j=null!==(c=null==v?void 0:null===(t=v.diagnostics)||void 0===t?void 0:t.active_role_count)&&void 0!==c?c:0,b=null!==(m=null==v?void 0:null===(a=v.diagnostics)||void 0===a?void 0:a.structural_debt)&&void 0!==m?m:0,f=((null!==(u=null==v?void 0:null===(n=v.diagnostics)||void 0===n?void 0:n.structural_density)&&void 0!==u?u:0)/1e4*100).toFixed(1),y=null!==(p=null==v?void 0:v.event_count)&&void 0!==p?p:0,N=null!==(h=null==v?void 0:null===(d=v.projection)||void 0===d?void 0:null===(o=d.departments)||void 0===o?void 0:o.length)&&void 0!==h?h:0,_=[{id:"org-root",type:"worldNode",position:{x:window.innerWidth/2-150,y:window.innerHeight/2-100},data:{label:"Organization",roleCount:g,activeCount:j,debt:b,densityPct:f,eventCount:y,deptCount:N,onZoomIn:x}}],w=(0,l.useMemo)(()=>_,[g,j,b,f,y,N,x]);return(0,s.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,s.jsx)(i.x$,{nodes:w,edges:[],nodeTypes:r,proOptions:{hideAttribution:!0},fitView:!0,minZoom:.5,maxZoom:2,children:(0,s.jsx)(i.Aq,{color:"#ccc",gap:16})})})}var d=a(41616),c=a(34161),m=a.n(c);let u=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#ec4899","#f97316"],p={departmentNode:function(e){let{data:t}=e,{department:a,color:l,onZoomToRoles:n,onFocusDept:r}=t,o=Math.min(200+20*a.role_ids.length,350),c=(a.internal_density/1e4*100).toFixed(1);return(0,s.jsxs)("div",{className:"department-node",style:{width:o,borderColor:l,boxShadow:"0 0 15px ".concat(l,"33")},children:[(0,s.jsx)(i.HH,{type:"target",position:d.Ly.Top}),(0,s.jsxs)("div",{className:"dept-node-header",children:[(0,s.jsx)("h3",{children:"Unclassified"===a.semantic_label?a.id.replace("dept_","Dep ").replace(/^Dep (\d+)/,(e,t)=>"Dep ".concat(parseInt(t)+1)):a.semantic_label}),(0,s.jsx)("span",{className:"dept-stage",children:a.scale_stage})]}),(0,s.jsxs)("div",{className:"dept-metrics",children:[(0,s.jsxs)("div",{className:"d-metric",children:[(0,s.jsx)("span",{children:"roles"}),(0,s.jsx)("strong",{children:a.role_ids.length})]}),(0,s.jsxs)("div",{className:"d-metric",children:[(0,s.jsx)("span",{children:"density"}),(0,s.jsxs)("strong",{children:[c,"%"]})]})]}),(0,s.jsxs)("div",{className:"dept-actions",style:{gap:6},children:[(0,s.jsx)("button",{className:"btn btn-sm btn-primary",onClick:r,children:"Focus"}),(0,s.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:n,children:"All roles"})]}),(0,s.jsx)(i.HH,{type:"source",position:d.Ly.Bottom})]})}};function h(e){let{state:t,onZoomOut:a,onZoomToRoles:n,onZoomToDept:r}=e,o=null==t?void 0:t.projection,{nodes:d,edges:c}=(0,l.useMemo)(()=>{if(!o||0===o.departments.length)return{nodes:[],edges:[]};let e=o.departments.map(e=>e.id);return function(e,t){let a=new(m()).graphlib.Graph;return a.setDefaultEdgeLabel(()=>({})),a.setGraph({rankdir:"TB",ranksep:100,nodesep:80,marginx:40,marginy:40}),e.forEach(e=>{let t=Math.min(200+20*e.data.department.role_ids.length,350);a.setNode(e.id,{width:t,height:160})}),t.forEach(e=>a.setEdge(e.source,e.target)),m().layout(a),{nodes:e.map(e=>{let t=a.node(e.id),s=Math.min(200+20*e.data.department.role_ids.length,350);return{...e,position:{x:t.x-s/2,y:t.y-80}}}),edges:t}}(o.departments.map(t=>{var a;return{id:t.id,type:"departmentNode",position:{x:0,y:0},draggable:!0,data:{department:t,color:(a=t.id,u[e.indexOf(a)%u.length]||u[0]),onZoomToRoles:n,onFocusDept:()=>r(t.id)}}}),o.inter_department_edges.map((e,t)=>({id:"e-".concat(e[0],"-").concat(e[1],"-").concat(t),source:e[0],target:e[1],style:{stroke:"#94a3b8",strokeWidth:2},animated:!0})))},[o,n,r]),[h,v,x]=(0,i.Rr)(d),[g,j,b]=(0,i.ll)(c);return(l.useEffect(()=>{v(d),j(c)},[d,c,v,j]),o&&0!==o.departments.length)?(0,s.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative"},children:[(0,s.jsx)("div",{className:"graph-toolbar",children:(0,s.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:a,children:"Overview"})}),(0,s.jsx)(i.x$,{nodes:h,edges:g,onNodesChange:x,onEdgesChange:b,nodeTypes:p,nodesDraggable:!0,proOptions:{hideAttribution:!0},fitView:!0,minZoom:.3,maxZoom:2,children:(0,s.jsx)(i.Aq,{color:"#e5e7eb",gap:24,size:1})})]}):(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-state-text",children:"No departments formed yet."}),(0,s.jsx)("button",{className:"btn btn-secondary mt-4",onClick:a,children:"Back"})]})}let v=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#ec4899","#f97316"];function x(e,t){return v[t.indexOf(e)%v.length]||v[0]}let g={roleNode:function(e){let{data:t}=e,{role:a,deptColor:l}=t;return(0,s.jsxs)("div",{className:"role-node",style:{position:"relative"},children:[(0,s.jsx)("div",{className:"dept-stripe",style:{backgroundColor:l}}),(0,s.jsx)(i.HH,{type:"target",position:d.Ly.Top}),(0,s.jsxs)("div",{className:"role-node-header",children:[(0,s.jsx)("span",{className:"role-node-name",children:a.name}),(0,s.jsx)("span",{className:"status-badge ".concat(a.active?"status-active":"status-inactive"),children:a.active?"active":"inactive"})]}),(0,s.jsx)("div",{className:"role-node-id",children:a.id}),(0,s.jsxs)("div",{className:"role-node-responsibilities",children:[a.responsibilities.slice(0,3).map(e=>(0,s.jsx)("span",{className:"resp-tag",children:e},e)),a.responsibilities.length>3&&(0,s.jsxs)("span",{className:"resp-tag",children:["+",a.responsibilities.length-3]})]}),(0,s.jsx)(i.HH,{type:"source",position:d.Ly.Bottom})]})},deptGroup:function(e){let{data:t}=e,a=(t.density/1e4*100).toFixed(1);return(0,s.jsxs)("div",{className:"dept-group-node",style:{borderColor:t.color},children:[(0,s.jsx)("div",{className:"dept-group-stripe",style:{backgroundColor:t.color}}),(0,s.jsx)("div",{className:"dept-group-label",children:t.label}),(0,s.jsxs)("div",{className:"dept-group-meta",children:[t.roleCount," roles / ",a,"% density"]})]})}};function j(e,t){let a=new(m()).graphlib.Graph;return a.setDefaultEdgeLabel(()=>({})),a.setGraph({rankdir:"TB",ranksep:80,nodesep:50,marginx:40,marginy:40}),e.forEach(e=>a.setNode(e.id,{width:"deptGroup"===e.type?280:200,height:"deptGroup"===e.type?50:90})),t.forEach(e=>a.setEdge(e.source,e.target)),m().layout(a),{nodes:e.map(e=>{let t=a.node(e.id);return t?{...e,position:{x:t.x-100,y:t.y-45}}:e}),edges:t}}function b(e){let{roles:t,dependencies:a,projection:n,focusDeptId:r,onClearFocus:o,onBackToDepts:d}=e,c=(0,l.useMemo)(()=>{var e;return null!==(e=null==n?void 0:n.departments.map(e=>e.id))&&void 0!==e?e:[]},[n]),m=(0,l.useMemo)(()=>{var e;return r&&n&&null!==(e=n.departments.find(e=>e.id===r))&&void 0!==e?e:null},[r,n]),{nodes:u,edges:p}=(0,l.useMemo)(()=>0===Object.keys(t).length?{nodes:[],edges:[]}:r&&n?function(e,t,a,s){let l=s.departments.find(t=>t.id===e);if(!l)return{nodes:[],edges:[]};let n=s.departments.map(e=>e.id),i=x(l.id,n),r=new Set(l.role_ids);return j(l.role_ids.map(e=>t[e]).filter(Boolean).map(e=>({id:e.id,type:"roleNode",position:{x:0,y:0},draggable:!0,data:{role:e,deptColor:i}})),a.filter(e=>r.has(e.from_role_id)&&r.has(e.to_role_id)).map((e,t)=>({id:"e-".concat(e.from_role_id,"-").concat(e.to_role_id,"-").concat(t),source:e.from_role_id,target:e.to_role_id,animated:e.critical,style:{stroke:e.critical?"#ef4444":"#475569",strokeWidth:e.critical?2.5:1.5,strokeDasharray:e.critical?"6 3":void 0},label:"operational"!==e.dependency_type?e.dependency_type:void 0,labelStyle:{fontSize:10,fill:"#94a3b8"}})))}(r,t,a,n):n&&n.departments.length>0?function(e,t,a){let s=a.departments.map(e=>e.id),l=[],n=[],i=0;for(let t of a.departments){let a=x(t.id,s),n=t.role_ids.map(t=>e[t]).filter(Boolean);if(0===n.length)continue;let r=i+140;l.push({id:"group-".concat(t.id),type:"deptGroup",position:{x:r-140,y:0},draggable:!1,selectable:!1,data:{label:t.semantic_label,color:a,roleCount:n.length,density:t.internal_density}}),n.forEach((e,t)=>{l.push({id:e.id,type:"roleNode",position:{x:r-110,y:60+130*t},draggable:!0,data:{role:e,deptColor:a}})}),i+=360}let r=new Set(Object.keys(e));return t.forEach((e,t)=>{var s,l;if(!r.has(e.from_role_id)||!r.has(e.to_role_id))return;let i=(null===(s=a.role_to_department)||void 0===s?void 0:s[e.from_role_id])!==(null===(l=a.role_to_department)||void 0===l?void 0:l[e.to_role_id]);n.push({id:"e-".concat(e.from_role_id,"-").concat(e.to_role_id,"-").concat(t),source:e.from_role_id,target:e.to_role_id,animated:e.critical,style:{stroke:e.critical?"#ef4444":i?"#f59e0b":"#475569",strokeWidth:e.critical?2.5:i?2:1.5,strokeDasharray:i?"8 4":e.critical?"6 3":void 0},label:"operational"!==e.dependency_type?e.dependency_type:void 0,labelStyle:{fontSize:10,fill:"#94a3b8"}})}),{nodes:l,edges:n}}(t,a,n):j(Object.values(t).map(e=>({id:e.id,type:"roleNode",position:{x:0,y:0},draggable:!0,data:{role:e,deptColor:"#475569"}})),a.map((e,t)=>({id:"e-".concat(e.from_role_id,"-").concat(e.to_role_id,"-").concat(t),source:e.from_role_id,target:e.to_role_id,animated:e.critical,style:{stroke:e.critical?"#ef4444":"#475569",strokeWidth:1.5}}))),[t,a,n,c,r]),[h,v,b]=(0,i.Rr)(u),[f,y,N]=(0,i.ll)(p);return(l.useEffect(()=>{v(u),y(p)},[u,p,v,y]),0===Object.keys(t).length)?(0,s.jsx)("div",{className:"empty-state",children:(0,s.jsx)("div",{className:"empty-state-text",children:"No roles. Use the event editor to begin."})}):(0,s.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative"},children:[(0,s.jsxs)("div",{className:"graph-toolbar",children:[d&&(0,s.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:d,children:"Departments"}),m&&o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"toolbar-divider"}),(0,s.jsxs)("span",{className:"toolbar-label",children:[m.semantic_label,(0,s.jsxs)("span",{className:"toolbar-meta",children:[m.role_ids.length," roles / ",(m.internal_density/1e4*100).toFixed(1),"%"]})]}),(0,s.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:o,children:"Show all"})]}),!r&&n&&n.departments.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"toolbar-divider"}),(0,s.jsxs)("span",{className:"toolbar-label",children:[n.departments.length," departments"]})]})]}),(0,s.jsxs)(i.x$,{nodes:h,edges:f,onNodesChange:b,onEdgesChange:N,nodeTypes:g,nodesDraggable:!0,fitView:!0,proOptions:{hideAttribution:!0},minZoom:.2,maxZoom:2,children:[(0,s.jsx)(i.Aq,{gap:24,size:1,color:"rgba(148, 163, 184, 0.06)"}),(0,s.jsx)(i.ZX,{}),(0,s.jsx)(i.a9,{nodeStrokeWidth:2,pannable:!0,zoomable:!0,nodeColor:e=>{var t,a;return"deptGroup"===e.type?(null===(t=e.data)||void 0===t?void 0:t.color)||"#475569":(null===(a=e.data)||void 0===a?void 0:a.deptColor)||"#475569"}})]})]})}let f={add_role:{label:"Add Role",fields:["id","name","purpose","responsibilities"]},remove_role:{label:"Remove Role",fields:["role_id"]},add_dependency:{label:"Add Dependency",fields:["from_role_id","to_role_id"]},inject_shock:{label:"Inject Shock",fields:["target_role_id","magnitude"]},apply_constraint_change:{label:"Apply Constraint Change",fields:["capital_delta","talent_delta","time_delta","political_cost_delta"]},differentiate_role:{label:"Differentiate Role",fields:["role_id"]},compress_roles:{label:"Compress Roles",fields:["source_role_id","target_role_id"]}};function y(e){let{onSubmit:t,loading:a,roleIds:n}=e,[i,r]=(0,l.useState)("add_role"),[o,d]=(0,l.useState)(""),[c,m]=(0,l.useState)(""),[u,p]=(0,l.useState)(""),[h,v]=(0,l.useState)(""),[x,g]=(0,l.useState)(""),[j,b]=(0,l.useState)(""),[y,N]=(0,l.useState)(""),[_,w]=(0,l.useState)(""),[C,k]=(0,l.useState)("5"),[S,D]=(0,l.useState)("operational"),[E,O]=(0,l.useState)(!1),[T,F]=(0,l.useState)(""),[I,R]=(0,l.useState)(""),[A,B]=(0,l.useState)(""),[Z,z]=(0,l.useState)(""),[G,H]=(0,l.useState)("");async function P(e){e.preventDefault(),d("");let a={};try{switch(i){case"add_role":if(!c||!u)throw Error("ID and Name are required");(a={id:c,name:u,purpose:h||u,responsibilities:x.split(",").map(e=>e.trim()).filter(Boolean)}).responsibilities&&0===a.responsibilities.length&&(a.responsibilities=["".concat(c,"_default")]);break;case"remove_role":case"differentiate_role":if(!_)throw Error("Role ID is required");a={role_id:_};break;case"add_dependency":if(!j||!y)throw Error("Both role IDs are required");a={from_role_id:j,to_role_id:y,dep_type:S,critical:E};break;case"inject_shock":if(!_)throw Error("Target role ID is required");a={target_role_id:_,magnitude:parseInt(C)||5};break;case"apply_constraint_change":a={},T&&(a.capital_delta=parseFloat(T)),I&&(a.talent_delta=parseFloat(I)),A&&(a.time_delta=parseFloat(A)),Z&&(a.political_cost_delta=parseFloat(Z));break;case"compress_roles":if(!G||!_)throw Error("Both role IDs are required");a={source_role_id:G,target_role_id:_}}await t({event_type:i,payload:a,timestamp:new Date().toISOString()}),m(""),p(""),v(""),g(""),b(""),N(""),w(""),k("5"),O(!1),F(""),R(""),B(""),z(""),H(""),d("")}catch(e){d(e instanceof Error?e.message:String(e))}}function q(e){let{value:t,onChange:a,label:l}=e;return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:l}),n.length>0?(0,s.jsxs)("select",{className:"select-field",value:t,onChange:e=>a(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select..."}),n.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}):(0,s.jsx)("input",{className:"input-field",value:t,onChange:e=>a(e.target.value),placeholder:"Role ID"})]})}return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-title",children:"Event Editor"}),(0,s.jsxs)("form",{onSubmit:P,style:{display:"flex",flexDirection:"column",gap:10},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Event Type"}),(0,s.jsx)("select",{className:"select-field",value:i,onChange:e=>{r(e.target.value),d("")},children:Object.entries(f).map(e=>{let[t,a]=e;return(0,s.jsx)("option",{value:t,children:a.label},t)})})]}),"add_role"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Role ID"}),(0,s.jsx)("input",{className:"input-field",value:c,onChange:e=>m(e.target.value),placeholder:"e.g. eng_lead"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Name"}),(0,s.jsx)("input",{className:"input-field",value:u,onChange:e=>p(e.target.value),placeholder:"e.g. Engineering Lead"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Purpose"}),(0,s.jsx)("input",{className:"input-field",value:h,onChange:e=>v(e.target.value),placeholder:"Optional"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Responsibilities (comma-separated)"}),(0,s.jsx)("input",{className:"input-field",value:x,onChange:e=>g(e.target.value),placeholder:"e.g. code_review, architecture"})]})]}),("remove_role"===i||"differentiate_role"===i)&&(0,s.jsx)(q,{value:_,onChange:w,label:"Role"}),"add_dependency"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q,{value:j,onChange:b,label:"From Role"}),(0,s.jsx)(q,{value:y,onChange:N,label:"To Role"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Type"}),(0,s.jsxs)("select",{className:"select-field",value:S,onChange:e=>D(e.target.value),children:[(0,s.jsx)("option",{value:"operational",children:"Operational"}),(0,s.jsx)("option",{value:"informational",children:"Informational"}),(0,s.jsx)("option",{value:"governance",children:"Governance"})]})]}),(0,s.jsxs)("div",{className:"form-group",style:{flexDirection:"row",alignItems:"center",gap:8},children:[(0,s.jsx)("input",{type:"checkbox",id:"critical",checked:E,onChange:e=>O(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"critical",className:"form-label",style:{marginBottom:0},children:"Critical"})]})]}),"inject_shock"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q,{value:_,onChange:w,label:"Target Role"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Magnitude (1–10)"}),(0,s.jsx)("input",{className:"input-field",type:"number",min:"1",max:"10",value:C,onChange:e=>k(e.target.value)})]})]}),"apply_constraint_change"===i&&(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Capital Δ"}),(0,s.jsx)("input",{className:"input-field",type:"number",step:"0.5",value:T,onChange:e=>F(e.target.value),placeholder:"0"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Talent Δ"}),(0,s.jsx)("input",{className:"input-field",type:"number",step:"0.5",value:I,onChange:e=>R(e.target.value),placeholder:"0"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Time Δ"}),(0,s.jsx)("input",{className:"input-field",type:"number",step:"0.5",value:A,onChange:e=>B(e.target.value),placeholder:"0"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"form-label",children:"Political Δ"}),(0,s.jsx)("input",{className:"input-field",type:"number",step:"0.5",value:Z,onChange:e=>z(e.target.value),placeholder:"0"})]})]}),"compress_roles"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q,{value:G,onChange:H,label:"Source Role (absorbed)"}),(0,s.jsx)(q,{value:_,onChange:w,label:"Target Role (absorbs)"})]}),o&&(0,s.jsx)("div",{className:"error-banner",children:o}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:a,children:a?"Applying…":"Apply Event"})]})]})}function N(e){let{diagnostics:t,eventCount:a}=e;if(!t)return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-title",children:"Diagnostics"}),(0,s.jsx)("div",{style:{color:"var(--text-muted)",fontSize:13},children:"No data yet"})]});let l=Math.min(100,t.structural_density/1e4*100),n=t.structural_debt>10?"high":t.structural_debt>5?"medium":"low";return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-title",children:"Diagnostics"}),(0,s.jsxs)("div",{className:"metric-grid",children:[(0,s.jsxs)("div",{className:"metric-item",children:[(0,s.jsx)("div",{className:"metric-value",children:t.role_count}),(0,s.jsx)("div",{className:"metric-label",children:"Total Roles"})]}),(0,s.jsxs)("div",{className:"metric-item",children:[(0,s.jsx)("div",{className:"metric-value",children:t.active_role_count}),(0,s.jsx)("div",{className:"metric-label",children:"Active"})]}),(0,s.jsxs)("div",{className:"metric-item",children:[(0,s.jsx)("div",{className:"metric-value",children:a}),(0,s.jsx)("div",{className:"metric-label",children:"Events"})]}),(0,s.jsxs)("div",{className:"metric-item",children:[(0,s.jsx)("div",{className:"metric-value",style:{color:"high"===n?"var(--accent-rose)":"medium"===n?"var(--accent-amber)":void 0,background:"low"===n?"var(--gradient-brand)":"none",WebkitBackgroundClip:"low"===n?"text":void 0,WebkitTextFillColor:"low"===n?"transparent":void 0},children:t.structural_debt}),(0,s.jsx)("div",{className:"metric-label",children:"Struct. Debt"})]})]}),(0,s.jsxs)("div",{style:{marginTop:16},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"var(--text-muted)",marginBottom:4},children:[(0,s.jsx)("span",{children:"Structural Density"}),(0,s.jsxs)("span",{children:[l.toFixed(1),"%"]})]}),(0,s.jsx)("div",{className:"density-bar-container",children:(0,s.jsx)("div",{className:"density-bar-fill",style:{width:"".concat(l,"%"),background:l>70?"var(--accent-rose)":"var(--gradient-brand)"}})})]}),t.governance_edges>0&&(0,s.jsxs)("div",{style:{marginTop:12,fontSize:12,color:"var(--text-secondary)"},children:["Governance edges: ",(0,s.jsx)("strong",{children:t.governance_edges})]}),t.warnings.length>0&&(0,s.jsxs)("div",{style:{marginTop:16,display:"flex",flexDirection:"column",gap:6},children:[(0,s.jsxs)("div",{className:"card-title",style:{marginBottom:0},children:["Warnings (",t.warnings.length,")"]}),t.warnings.map((e,t)=>(0,s.jsxs)("div",{className:"warning-item",children:[(0,s.jsx)("span",{className:"warning-icon",children:"⚠"}),(0,s.jsx)("span",{children:e})]},t))]})]})}var _=a(27648);function w(e){var t,a,i,r,d,c,m,u,p;let{projectId:v}=e,[x,g]=(0,l.useState)(1),[j,f]=(0,l.useState)(null),[w,C]=(0,l.useState)(!1),[k,S]=(0,l.useState)(""),[D,E]=(0,l.useState)(null),O=(0,l.useCallback)(async()=>{C(!0),S("");try{let e=await (0,n.y0)(v);f(e)}catch(e){S(e instanceof Error?e.message:String(e))}finally{C(!1)}},[v]);(0,l.useEffect)(()=>{O()},[O]);let T=async e=>{C(!0),S("");try{let t=await (0,n.IV)(v,e);f(t)}catch(e){throw S(e instanceof Error?e.message:String(e)),e}finally{C(!1)}},F=(0,l.useCallback)(()=>{E(null),g(3)},[]),I=(0,l.useCallback)(e=>{E(e),g(3)},[]),R=(0,l.useCallback)(()=>{E(null)},[]),A=(null==j?void 0:j.roles)&&Object.keys(j.roles).length>0&&null!==(r=null===(t=Object.values(j.roles)[0])||void 0===t?void 0:t.scale_stage)&&void 0!==r?r:"",B=j?Object.keys(j.roles):[],Z=3===x?D?(null==j?void 0:null===(i=j.projection)||void 0===i?void 0:null===(a=i.departments.find(e=>e.id===D))||void 0===a?void 0:a.semantic_label)||"Focused":"All Roles":2===x?"Departments":"Overview";return(0,s.jsxs)("div",{className:"app-layout",children:[(0,s.jsxs)("header",{className:"app-header",children:[(0,s.jsx)(_.default,{href:"/",style:{textDecoration:"none"},children:(0,s.jsx)("div",{className:"header-brand",style:{cursor:"pointer"},children:"OrgKernel"})}),(0,s.jsxs)("div",{className:"header-meta",children:[(0,s.jsxs)("div",{className:"meta-item",children:[(0,s.jsx)("span",{className:"meta-label",children:"project"}),(0,s.jsx)("span",{className:"meta-value",children:v})]}),(0,s.jsxs)("div",{className:"meta-item",children:[(0,s.jsx)("span",{className:"meta-label",children:"view"}),(0,s.jsx)("span",{className:"meta-value",children:Z})]}),j&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"meta-item",children:[(0,s.jsx)("span",{className:"meta-label",children:"seq"}),(0,s.jsx)("span",{className:"meta-value",children:j.event_count})]}),(0,s.jsxs)("div",{className:"meta-item",children:[(0,s.jsx)("span",{className:"meta-label",children:"hash"}),(0,s.jsx)("span",{className:"hash-badge",children:j.state_hash.slice(0,10)})]}),A&&(0,s.jsxs)("div",{className:"meta-item",children:[(0,s.jsx)("span",{className:"meta-label",children:"stage"}),(0,s.jsx)("span",{className:"meta-value",children:A})]})]})]})]}),(0,s.jsxs)("main",{className:"main-canvas",children:[w&&(0,s.jsx)("div",{className:"loading-overlay",children:(0,s.jsx)("div",{className:"spinner"})}),k&&(0,s.jsx)("div",{className:"error-banner-container",children:(0,s.jsx)("div",{className:"error-banner",children:k})}),1===x&&(0,s.jsx)(o,{state:j,onZoomIn:()=>g(2)}),2===x&&(0,s.jsx)(h,{state:j,onZoomOut:()=>g(1),onZoomToRoles:F,onZoomToDept:I}),3===x&&(0,s.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative"},children:[(0,s.jsx)(b,{roles:null!==(d=null==j?void 0:j.roles)&&void 0!==d?d:{},dependencies:null!==(c=null==j?void 0:j.dependencies)&&void 0!==c?c:[],projection:null!==(m=null==j?void 0:j.projection)&&void 0!==m?m:null,focusDeptId:D,onClearFocus:R,onBackToDepts:()=>g(2)}),(0,s.jsx)("div",{style:{position:"absolute",bottom:24,left:24,zIndex:10,width:320,maxHeight:"calc(100vh - 120px)",overflowY:"auto",boxShadow:"var(--shadow-card)",borderRadius:"var(--radius-lg)"},children:(0,s.jsx)(y,{onSubmit:T,loading:w,roleIds:B})})]}),(0,s.jsx)("div",{className:"diagnostics-floating",children:(0,s.jsx)(N,{diagnostics:null!==(u=null==j?void 0:j.diagnostics)&&void 0!==u?u:null,eventCount:null!==(p=null==j?void 0:j.event_count)&&void 0!==p?p:0})})]})]})}var C=a(99376);function k(){let e=(0,C.useParams)(),t=null==e?void 0:e.id;return t?(0,s.jsx)(w,{projectId:t}):null}},71837:function(e,t,a){"use strict";a.d(t,{IV:function(){return c},Pj:function(){return r},hW:function(){return n},mr:function(){return o},th:function(){return i},tq:function(){return m},y0:function(){return d}});let s="http://localhost:8000".replace(/\/+$/,"");async function l(e,t){let a=await fetch("".concat(s).concat(e),{headers:{"Content-Type":"application/json"},...t});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"API error: ".concat(a.status));return a.json()}async function n(e){if(e&&0===e.length)return[];let t="/projects";return e&&e.length>0&&(t+="?project_ids=".concat(encodeURIComponent(e.join(",")))),l(t)}async function i(e){return l("/projects/".concat(e),{method:"DELETE"})}async function r(e,t){return l("/projects/".concat(e,"/rename"),{method:"PATCH",body:JSON.stringify({new_name:t})})}async function o(e,t){return l("/projects/".concat(e,"/duplicate"),{method:"POST",body:JSON.stringify({new_project_id:t})})}async function d(e){return l("/projects/".concat(e,"/state"))}async function c(e,t){return l("/projects/".concat(e,"/append-event"),{method:"POST",body:JSON.stringify(t)})}async function m(e,t){return l("/projects/".concat(e,"/generate-org"),{method:"POST",body:JSON.stringify(t)})}}},function(e){e.O(0,[299,167,648,898,971,117,744],function(){return e(e.s=98105)}),_N_E=e.O()}]);